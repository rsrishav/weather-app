<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>Weather Django App</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
          integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <!-- jQuery library -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"
            integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
          integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>

    <style>

    .container {
        max-width: 100%;
    }

    .autocomplete {
        position: relative;
        display: inline-block;
    }

    span {
        font-size: small;
    }


    input {
        border: 1px solid transparent;
        background-color: #f1f1f1;
        padding: 10px;
        font-size: 16px;
    }

    input[type=text] {
        background-color: #f1f1f1;
        width: 100%;
    }

    input[type=submit] {
        background-color: DodgerBlue;
        color: #fff;
        cursor: pointer;
    }

    .autocomplete-items {
        position: absolute;
        border: 1px solid #d4d4d4;
        border-bottom: none;
        border-top: none;
        z-index: 99;
        /*position the autocomplete items to be the same width as the container:*/
        top: 100%;
        left: 0;
        right: 0;
    }

    .autocomplete-items div {
        padding: 10px;
        cursor: pointer;
        background-color: #fff;
        border-bottom: 1px solid #d4d4d4;
    }

    /*when hovering an item:*/
    .autocomplete-items div:hover {
        background-color: #e9e9e9;
    }

    /*when navigating through the items using the arrow keys:*/
    .autocomplete-active {
        background-color: DodgerBlue !important;
        color: #ffffff;
    }

    .row {
        margin-right: 0px;
        margin-left: 0px;
    }

    /* FOOTER
    –––––––––––––––––––––––––––––––––––––––––––––––––– */
    .page-footer {
        font-size: 1rem;
        color: var(--text_light);
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
    }

    .page-footer span {
        color: var(--red);
    }

    .page-footer small {
        color: white;
    }

    </style>
</head>

<body style="background-color: #4b515d;">
<header class="p-3 bg-dark text-white">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                <h4 style="font-family: system-ui;font-size: 150%;">Weather Data</h4>
            </a>
            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            </ul>
            <form id="form_id" class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" method="post">
                {% csrf_token %}
                <input class="form-control form-control-dark" id="myInput" name="city"
                       placeholder="City name" list="datalistOptions" oninput="get_cities()" onchange="get_cities()"
                       onblur="get_cities()" required>
            </form>
            <div class="text-end">
                <datalist id="datalistOptions" onchange="this.form.submit()">
                </datalist>
                <button class="btn btn-outline-light btn-dark" type="submit" form="form_id">Search</button>
            </div>
        </div>
    </div>
</header>
<!--{% if country_code and coordinate and temp and pressure and humidity %}-->
<!--<div class="card" style="width: 18rem; margin: 2%;">-->
<!--    &lt;!&ndash;    <img src="..." class="" alt="...">&ndash;&gt;-->
<!--    <div class="card-body">-->

<!--        <h4 class="card-title">{{city_name}}<span>({{country_code}})</span> <i class="{{weather_icon}}"-->
<!--                                                                               style="font-size: xx-large;"></i></h4>-->
<!--        <ul class="list-group list-group-flush">-->
<!--            <li class="list-group-item">Temperature : <strong>{{temp}}</strong></li>-->
<!--            <li class="list-group-item">Feels like : <strong>{{feels_like}}</strong></li>-->
<!--            <li class="list-group-item">Humidity : <strong>{{humidity}}%</strong></li>-->
<!--            <li class="list-group-item">Weather : <strong>{{weather_condition}}</strong></li>-->
<!--        </ul>-->


<!--    </div>-->
<!--</div>-->
<!--{% elif data_status == "not_found" %}-->
<!--<div class="col-md-4 col-md-offset-4">-->
<!--    No data found !!!-->
<!--</div>-->
<!--{% endif %}-->

<section>
    <div class="container py-5 h-100">

        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-8 col-lg-6 col-xl-4">
                {% if country_code and coordinate and temp and pressure and humidity %}
                <div class="card" style="color: #4B515D; border-radius: 35px;">
                    <div class="card-body p-4">

                        <div class="d-flex">
                            <h6 class="flex-grow-1">{{city_name}}<span>({{country_code}})</span></h6>
                            <h6>{{time}}</h6>
                        </div>

                        <div class="d-flex flex-column text-center mt-5 mb-4">
                            <h6 class="display-4 mb-0 font-weight-bold" style="color: #1C2331;"> {{temp}} </h6>
                            <span class="small" style="color: #868B94">{{weather_condition}}</span>
                        </div>

                        <div class="d-flex align-items-center">
                            <div class="flex-grow-1" style="font-size: 1rem;">
                                <div><i class="fas fa-wind fa-fw" style="color: #868B94;"></i> <span class="ms-1"> {{wind}} km/h </span></div>
                                <div><i class="fas fa-tint fa-fw" style="color: #868B94;"></i> <span class="ms-1"> {{humidity}}% </span></div>
                            </div>
                            <div>
                                <img src="/static/haze.png" width="100px">
                            </div>
                        </div>

                    </div>
                </div>
                {% elif data_status == "not_found" %}
                <div class="col-md-4 col-md-offset-4">
                    No data found !!!
                </div>
                {% endif %}
            </div>
        </div>

    </div>
</section>

<footer class="page-footer">
    <!--    <small>Made with <span>❤</span> by <a href="https://github.com/rsrishav" target="_blank">Rishav</a>-->
    <small>Made with <span>❤</span> by Rishav</small>
</footer>
<script>
$('#myInput').bind('input change blur',function(){
    search_city_name = document.getElementById("myInput").value;
    search_city = (search_city_name == null || search_city_name == "") ? "null" : search_city_name;
    var url = "/city/"+search_city;
    let dropdown = $('#datalistOptions');
    dropdown.empty();
    $.getJSON(url, function (data) {
        $.each(data, function (index, value) {
            $('#datalistOptions').append('<option value="' + value.payload.displayName + ', IN"></option>');
            console.log(value);
        });
    });
});
<!--function get_cities() {-->
<!--    search_city_name = document.getElementById("myInput").value;-->
<!--    search_city = (search_city_name == null || search_city_name == "") ? "null" : search_city_name;-->
<!--    var url = "/city/"+search_city;-->
<!--    let dropdown = $('#datalistOptions');-->
<!--    dropdown.empty();-->
<!--    $.getJSON(url, function (data) {-->
<!--        $.each(data, function (index, value) {-->
<!--            // APPEND OR INSERT DATA TO SELECT ELEMENT.-->
<!--                    $('#datalistOptions').append('<option value="' + value.payload.displayName + ', IN"></option>');-->
<!--            console.log(value);-->
<!--        });-->
<!--    });-->
<!--}-->

</script>
</body>
</html>
